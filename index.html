// ì‹œê³„ (ê¸°ì¡´ê³¼ ë™ì¼)
function updateClock(){
    const now=new Date();
    const y=now.getFullYear(), m=String(now.getMonth()+1).padStart(2,'0'), d=String(now.getDate()).padStart(2,'0');
    const days=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
    const wd=days[now.getDay()];
    const hh=String(now.getHours()).padStart(2,'0'), mm=String(now.getMinutes()).padStart(2,'0'), ss=String(now.getSeconds()).padStart(2,'0');
    clockDisplay.textContent=`${y}-${m}-${d} (${wd}) ${hh}:${mm}:${ss}`;
}
setInterval(updateClock,1000); updateClock();

// TAB (ê¸°ì¡´ê³¼ ë™ì¼)
function showTab(id,event){
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".tab-buttons button").forEach(b=>b.classList.remove("active"));
    event.target.classList.add("active");
}

// ğŸ’¡ ê°œì„ ëœ ìˆ«ì ì…ë ¥ ì²˜ë¦¬
function addComma(num){
    // ì†Œìˆ˜ì  ì…‹ì§¸ ìë¦¬ì—ì„œ ë°˜ì˜¬ë¦¼í•˜ì—¬ ë‘ ìë¦¬ê¹Œì§€ë§Œ í‘œì‹œ
    return Number(num).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
function uncomma(str){
    return parseFloat(String(str).replace(/,/g,"")) || 0;
}
document.querySelectorAll(".num").forEach(input => {
    input.addEventListener("input", function() {
        let raw = this.value.replace(/,/g,"");
        raw = raw.replace(/[^\d.]/g,""); // ìˆ«ìì™€ ì˜¨ì (.)ë§Œ í—ˆìš©
        
        // ì†Œìˆ˜ì  ë‘ ê°œ ì´ìƒ ë°©ì§€
        const parts = raw.split('.');
        if(parts.length > 2) {
            raw = parts[0] + '.' + parts[1];
        }
        
        // ì…ë ¥ ê°’ì´ ìˆë‹¤ë©´ ì½¤ë§ˆ ì ìš© í›„ í‘œì‹œ. ëì´ ì†Œìˆ˜ì ì¼ ê²½ìš° ì½¤ë§ˆë§Œ ì ìš©
        if(raw !== "") {
            const hasDecimal = raw.endsWith('.');
            const formatted = uncomma(raw).toLocaleString('ko-KR', { maximumFractionDigits: 20 });
            this.value = hasDecimal ? formatted + '.' : formatted;
        } else {
            this.value = "";
        }
    });

    // blur ì‹œì ì—ì„œ ìµœì¢… í¬ë§·íŒ… (ì†Œìˆ˜ì  ì…‹ì§¸ìë¦¬ ë°˜ì˜¬ë¦¼)
    input.addEventListener("blur", function() {
        const val = uncomma(this.value);
        if(!isNaN(val) && val !== 0) {
            this.value = addComma(val);
        }
    });
});


// ğŸ’° ì˜ˆê¸ˆ (Deposit)
function calcDeposit(){
    const P=uncomma(dep_amount.value); // ì›ê¸ˆ
    const annualRate=uncomma(dep_rate.value)/100; // ì—° ì´ììœ¨
    const m=Number(uncomma(dep_month.value)); // ê¸°ê°„ (ê°œì›”)
    const type=dep_type.value;
    let total=0;

    if(type==="simple") { // ë‹¨ë¦¬
        // P * ( 1 + ì—°ì´ìœ¨ * (ê°œì›”ìˆ˜ / 12) )
        total = P * (1 + annualRate * (m / 12));
    } else if(type==="monthly") { // ì›”ë³µë¦¬
        const monthlyRate = annualRate / 12;
        // P * ( 1 + ì›”ì´ìœ¨ ) ^ ê°œì›”ìˆ˜
        total = P * Math.pow(1 + monthlyRate, m);
    } else if(type==="yearly") { // ì—°ë³µë¦¬
        // P * ( 1 + ì—°ì´ìœ¨ ) ^ (ê°œì›”ìˆ˜ / 12)
        total = P * Math.pow(1 + annualRate, m / 12);
    }
    
    const interest=total-P;
    dep_result.innerHTML=`ğŸ’° <b>ì˜ˆê¸ˆ ê²°ê³¼</b><br>ì›ê¸ˆ: ${addComma(P)}ì›<br>ì´ì: ${addComma(interest)}ì›<br>ë§Œê¸°ìˆ˜ë ¹ì•¡: <b>${addComma(total)}ì›</b>`;
}

// ğŸ“¦ ì ê¸ˆ (Saving)
function calcSaving(){
    const A = uncomma(sav_amount.value); // ì›” ë‚©ì…ì•¡
    const annualRate = uncomma(sav_rate.value)/100; // ì—° ì´ììœ¨
    const n = Number(uncomma(sav_month.value)); // ê¸°ê°„ (ê°œì›”)
    const type = sav_type.value;

    let total = 0;

    if(type === "compound"){ // ë³µë¦¬(ì€í–‰ì‹) - ê¸°ë§ë¶ˆ ì›”ë³µë¦¬ ì ìš©
        const r = annualRate / 12; // ì›” ì´ììœ¨
        total = 0;
        
        // ë§¤ì›” ë‚©ì…í•˜ëŠ” Aì— ëŒ€í•´ ë‚¨ì€ ê¸°ê°„ ë™ì•ˆ ì›”ë³µë¦¬ ì´ì ì ìš© í›„ í•©ì‚°
        for(let i=1; i<=n; i++){
            // ë‚©ì…ì•¡ AëŠ” n-iê°œì›” ë™ì•ˆ ì´ì ì ìš© (ì²« ë‹¬ ë‚©ì…ì•¡ì€ n-1ê°œì›”, ë§ˆì§€ë§‰ ë‹¬ì€ 0ê°œì›”)
            // ì€í–‰ì€ í†µìƒ ê¸°ë§ë¶ˆ(ì›” ë§ ë‚©ì…) ê¸°ì¤€ì˜ ì›”ë³µë¦¬ë¥¼ ì‚¬ìš©
            const power = n - i;
            total += A * Math.pow(1 + r, power);
        }
    } else { // ë‹¨ë¦¬
        // ê° ì›”ë³„ ë‚©ì…ê¸ˆì•¡ì— ëŒ€í•´ ë‚¨ì€ ê¸°ê°„ë§Œí¼ ë‹¨ë¦¬ ì´ì ì ìš©
        total = 0;
        for(let i=0; i<n; i++){
            // (n-i)ëŠ” ë‚¨ì€ ê°œì›” ìˆ˜. n-i / 12 ëŠ” ë‚¨ì€ ì—° ë‹¨ìœ„ ê¸°ê°„.
            total += A * (1 + annualRate * ((n-i) / 12));
        }
    }

    const paid = A*n;
    const interest = total - paid;

    sav_result.innerHTML = `
        ğŸ“¦ <b>ì ê¸ˆ ê²°ê³¼</b><br>
        ì´ ë‚©ì…ì•¡: ${addComma(paid)}ì›<br>
        ì´ì: ${addComma(interest)}ì›<br>
        ë§Œê¸°ìˆ˜ë ¹ì•¡: <b>${addComma(total)}ì›</b>
    `;
}

// ğŸ¦ ëŒ€ì¶œ (Loan)
function calcLoan(){
    const L=uncomma(loan_amount.value); // ëŒ€ì¶œ ì›ê¸ˆ
    const annualRate=uncomma(loan_rate.value)/100; // ì—° ì´ììœ¨
    const r=annualRate/12; // ì›” ì´ììœ¨
    const n=Number(uncomma(loan_month.value)); // ê¸°ê°„ (ê°œì›”)
    const type=loan_type.value;
    
    let monthly=0, total=0, interest=0;

    if(type==="amortization"){ // ì›ë¦¬ê¸ˆê· ë“±
        // ì›” ìƒí™˜ì•¡ = L * [ r * (1+r)^n ] / [ (1+r)^n - 1 ]
        monthly = L * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
        total=monthly*n; 
        interest=total-L;
    } else if(type==="principal"){ // ì›ê¸ˆê· ë“±
        const principal=L/n; // ë§¤ì›” ìƒí™˜ ì›ê¸ˆ
        let intSum=0;
        // ì”ê¸ˆ(L-principal*i)ì— ì›” ì´ììœ¨ rì„ ê³±í•´ ì´ì í•©ì‚°
        for(let i=0;i<n;i++) {
            const currentInterest = (L - principal * i) * r;
            intSum += currentInterest;
        }
        interest=intSum; 
        total=L+interest;
        monthly="ë§¤ì›” ì›ê¸ˆ "+addComma(principal)+"ì› + ì´ì";
    } else if(type==="bullet"){ // ë§Œê¸°ì¼ì‹œ
        // ì´ ì´ì = L * r * n
        interest=L*r*n; 
        total=L+interest; 
        // ë§¤ì›” ì´ì = L * r
        monthly="ë§¤ì›” ì´ì "+addComma(L*r)+"ì›";
    }
    loan_result.innerHTML=`ğŸ¦ <b>ëŒ€ì¶œ ê²°ê³¼</b><br>ì›” ë‚©ì…ì•¡: ${typeof monthly==="string"?monthly:addComma(monthly)+"ì›"}<br>ì´ ì´ì: ${addComma(interest)}ì›<br>ìµœì¢… ìƒí™˜ì•¡: <b>${addComma(total)}ì›</b>`;
}

// ìŠ¤íƒ€í•„ë“œ (ê¸°ì¡´ê³¼ ë™ì¼)
const canvas=document.getElementById("space"), ctx=canvas.getContext("2d"); let w,h;
function resize(){w=canvas.width=window.innerWidth; h=canvas.height=window.innerHeight;}
window.addEventListener("resize",resize); resize();
let stars=[]; let count=1000; let focal=500;
function initStars(){stars=[];for(let i=0;i<count;i++){stars.push({x:(Math.random()-0.5)*w,y:(Math.random()-0.5)*h,z:Math.random()*focal,speed:0.4+Math.random()});}}
initStars();
function animate(){ctx.clearRect(0,0,w,h);for(let s of stars){s.z-=s.speed;if(s.z<=0){s.z=focal;s.x=(Math.random()-0.5)*w;s.y=(Math.random()-0.5)*h;}let k=focal/s.z,px=s.x*k+w/2,py=s.y*k+h/2;ctx.fillStyle="rgba(255,255,255,"+(1-s.z/focal)+")";ctx.beginPath();ctx.arc(px,py,1.2+(1-s.z/focal)*2,0,Math.PI*2);ctx.fill();}requestAnimationFrame(animate);}
animate();
</script>
</body>
</html>
